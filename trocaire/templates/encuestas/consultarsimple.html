{% extends "base.html" %}
{% block extratitle %}Consultas Simples{% endblock %}

{%block extrahead%}
<link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/base/jquery-ui.css" rel="stylesheet" type="text/css"/>
<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/jquery-ui.min.js" type="text/javascript"></script>
<link type="text/css" rel="stylesheet"  href="{{MEDIA_URL}}css/jquery.multiselect.css" >
<script src="{{MEDIA_URL}}js/jquery.multiselect.min.js" type="text/javascript"></script>
<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
<script type="text/javascript" src="{{MEDIA_URL}}js/markerclusterer.js"></script>

<script type="text/javascript">
    var map;

    $(document).ready(function() {


        $("#id_contraparte").multiselect({
            noneSelectedText: 'Contrapartes',
            selectedText: 'Contraparte',
            checkAllText: 'Todos',
            uncheckAllText: 'Quitar todos',
            minWidth: 200,
            beforeclose: function(event, ui){
                var selectos = $("#id_contraparte").multiselect("getChecked").map(function(){
                    //console.log(this.value)
                    return this.value;
                }).get();
                
            }
        });

        $("#id_fecha").multiselect({
            noneSelectedText: 'Fecha',
            selectedText: 'Fecha',
            checkAllText: 'Todos',
            uncheckAllText: 'Quitar todos',
            minWidth: 200,
            beforeclose: function(event, ui){
                var selectos = $("#id_fecha").multiselect("getChecked").map(function(){
                    //console.log(this.value)
                    return this.value;
                }).get();
                
            }
        });


        var departamento = document.getElementById("id_departamento");
        var municipio = document.getElementById("id_municipio");
        var comarca = document.getElementById("id_comarca");
        
        //municipios
        $("#id_departamento").change(function () {
            var index = departamento.options.selectedIndex;
            var id = departamento.options[index].value;
            $.getJSON("/consultar/ajax/municipio/" + id +"/",
            function(data){
                municipio.options.length = 0;
                municipio.options[0] = new Option("--------");
                for(i=0; i< data.length; i++){
                    municipio.options[i+1] = new Option(data[i][1], data[i][0]);
                }
            });
        });
        
        //comarca
        $("#id_municipio").change(function () {
            var index = municipio.options.selectedIndex;
            var id = municipio.options[index].value;
            $.getJSON("/consultar/ajax/comarca/" + id +"/",
            function(data){
                comarca.options.length = 0;
                comarca.options[0] = new Option("---------");
                for(i=0; i< data.length; i++){
                    comarca.options[i+1] = new Option(data[i][1], data[i][0]);
                }
            });
        });
        // fin de los multiseldct

        var infowindow = new google.maps.InfoWindow();
//         13.625731451874081
        var myLatlng = new google.maps.LatLng(13.125,-85.243);
        var myOptions = {
            zoom: 7,
            mapTypeControl: true,
            center: myLatlng,
            mapTypeId: google.maps.MapTypeId.TERRAIN
        }
        map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
        $.getJSON('/mapa/', function(data) {
            $.each(data[0], function(name, item) {
                var latlng = new google.maps.LatLng(item.lat, item.lon);
                var marker = new google.maps.Marker({
                    position : latlng,
                    map : map,
                    title : name,
                    icon : 'http://chart.apis.google.com/chart?chst=d_bubble_text_small&chld=bbT|'+(item.hombres+item.mujeres)+'|FABF15|000000',
                    item : ''                   
                });
                google.maps.event.addListener(marker, 'click', function() {
                    infowindow.open(map, marker);
                    var text = '<div class="infowindow"><b>'+name+'</b><br><div class="info">';
                    text += '<span>"Hombres:" </span>'+item.hombres+'<br> <span> "Mujeres:"</span> '+item.mujeres;                
                    text += '<br><span>"Total:"</span> '+(item.hombres+item.mujeres)+'</div></div>';
                    infowindow.setContent(text);
                });
            });
        });

    }); // fin del documents
</script>
<style type="text/css">
.hidden{
	visibility: hidden;
}
</style>
{% endblock %}


{% block contenido %}
<style type="text/css">
    #map_canvas {
    height: 410px;
    margin: 0 auto;
    width: 568px;
    }
    .infowindow{font-size: 13px; color: #069;}  
    .infowindow span{color: #4E4E4E;}
    .infowindow .info{font-size: 13px; margin-top: 6px;} 
</style>
<div style="float:left;">  
    <form method="POST" action="." id="consultar-form">{% csrf_token %}
        <div class="general">
            <div class="columnaform">
                <div class="label">{{form.fecha.label}}</div>
                <div class="filtros">{{form.fecha}}<br>{{form.fecha.errors}}</div>
                <div class="clean"></div>
                <div class="label">{{form.contraparte.label}}</div>
                <div class="filtros">{{form.contraparte}}<br>{{form.contraparte.errors}}</div>
                <div class="clean"></div>
                <div class="label">{{form.departamento.label}}</div>
                <div class="filtros">{{form.departamento}}<br>{{form.departamento.errors}}</div>
                <div class="clean"></div>
                <div class="label">{{form.municipio.label}}</div>
                <div class="filtros">{{form.municipio}}<br>{{form.municipio.errors}}</div>
                <div class="clean"></div>
                <div class="label">{{form.comarca.label}}</div>
                <div class="filtros">{{form.comarca}}<br>{{form.comarca.errors}}</div> 
                <div class="clean"></div>    
            <div class="label hidden">{{form.escolaridad_beneficiario.label}}</div>
            <div class="filtros hidden">{{form.escolaridad_beneficiario}}<br>{{form.escolaridad_beneficiario.errors}}</div>                
            <div class="label hidden">{{form.escolaridad_conyugue.label}}</div>
            <div class="filtros hidden">{{form.escolaridad_conyugue}}<br>{{form.escolaridad_conyugue.errors}}</div>
            <div class="clean"></div>
        </div>
        <div class="columnaform hidden"><br>
            <div class="label">{{form.dependientes_max.label}}</div>
            <div class="filtros">{{form.dependientes_max}}<br>{{form.dependientes_max.errors}}</div>
            <div class="filtros">{{form.dependientes_min}}<br>{{form.dependientes_min.errors}}</div>
            <div class="clean"></div>
            <div class="label">{{form.familia_beneficiario.label}}</div>
            <div class="filtros">{{form.familia_beneficiario}}<br>{{form.familia_beneficiario.errors}}</div>
            <div class="clean"></div>
            <div class="label">{{form.credito_acceso.label}}</div>
            <div class="filtros">{{form.credito_acceso}}<br>{{form.credito_acceso.errors}}</div>
            <div class="clean"></div>
            <div class="label">{{form.desicion_gasto_mayor.label}}</div>
            <div class="filtros">{{form.desicion_gasto_mayor}}<br>{{form.desicion_gasto_mayor.errors}}</div>
            <div class="clean"></div>
            <div class="label">{{form.desicion_inversion.label}}</div>
            <div class="filtros">{{form.desicion_inversion}}<br>{{form.desicion_inversion.errors}}</div>
            <div class="clean"></div>
            </div>
            <div class="clean"></div>
            <input type="submit" value=""  class="consultar"/>
        <div class="clean"></div>
        </div>        
    </form>
</div>
{%if muestra_indicador != 1%}
<div id="bloqueindicadores">
    <div id="mapaindex">
        <div id="map_canvas"></div>
    </div>
</div>
{%endif%}
{%if muestra_indicador = 1%}
<div id="bloqueindicadores">
    <div class="indicadorcategoria">FAMILIAS</div>
        <a href="/encuestas/datos-x-sexo/">Sexo jefe de familia</a>
        <a href="/encuestas/sexo-beneficiario/">Sexo de beneficiario/a y jefatura de familia</a>
        <a href="/encuestas/escolaridad/">Escolaridad de beneficiario/a</a>
        {% if request.session.fecha != '2012' %}
        <a href="/encuestas/dependencia/">Dependencia familiar</a>
        {%endif%}
        <div class="clean"></div>
    <div class="indicadorcategoria">INGRESOS FAMILIARES</div>
        {% if request.session.fecha != '2012' %}
        <a href="/encuestas/credito/">Acceso a crédito </a>
        {%endif%}
        <a href="/encuestas/ingreso-agropecuario/">% de Familias con Ingresos Agropecuarios</a>
        <a href="/encuestas/ingreso-familiar-agropecuario/">Ingresos Familiares Agropecuarios</a>
        <a href="/encuestas/ingreso-familiar/">Ingresos Familiares</a>
        <a href="/encuestas/ingreso-desglose/">Ingresos x categoria</a>
        <div class="clean"></div>
        
    <div class="indicadorcategoria">SEGURIDAD ALIMENTARIA</div>
        <a href="/encuestas/abastecimiento/">Autoabastecimiento de granos básicos</a>
        <a href="/encuestas/diversidad-alimentaria/">Diversidad de la dieta</a>
        <div class="clean"></div>
        
    <div class="indicadorcategoria">PROCESAMIENTO Y MERCADOS</div>
        <a href="/encuestas/venta-organizada/">Venta organizada</a>
        <a href="/encuestas/familias-venden/">Familias que venden</a>
        <a href="/encuestas/procesando-productos/">Familias que venden procesados</a>
        <div class="clean"></div>
        
    <div class="indicadorcategoria">PRODUCCIÓN SOSTENIBLE</div>
        {% if request.session.fecha != '2012' %}
        <a href="/encuestas/familias-practicas/">Conservación de suelo y agua</a>
        {%endif%}
        <a href="/encuestas/diversificacion-productiva/">Diversificación productiva</a>
       <a href="/encuestas/cuatro-cuatro/">Produccion</a>
       <a href="/encuestas/cperiodos/">Cult. periodos</a>
       <a href="/encuestas/cpermanentes/">Cult. permanentes</a>
       <a href="/encuestas/canuales/">Cult. anuales</a>
        <div class="clean"></div>
    {% if request.session.fecha != '2012' %}    
    <div class="indicadorcategoria">ACCESO A TIERRA Y AGUA</div>
        <a href="/encuestas/agua-clorada/">Agua segura</a>
        <a href="/encuestas/gastan-horas/">Tiempo de recolección de agua</a>
        <a href="/encuestas/acceso-agua/">Acceso a riego</a>
        <a href="/encuestas/acceso-tierra/">Acceso a tierra</a>
        <div class="clean"></div>
          
    <div class="indicadorcategoria">GENERO Y PARTICIPACIÓN</div>
        <a href="/encuestas/participacion/">Participación Ciudadana</a>
        <a href="{% url hombre_responsable %}">hombres hacen tareas domésticas</a>
        <a href="{% url mujeres_decisiones %}">Mujeres toman decisiones</a><br>
        <div class="clean"></div>
    {% endif %} 

</div>
{% endif %}
<div class="clean"></div>
<br>
{% endblock %}
